%YAML 1.2
---
name: Asm
file_extensions: [asm,s,S]
scope: source.asm

contexts:
  main:
    - match: \b(aaa|aad|aam|aas|adc|adcx|add|addpd|addps|addsd|addss|addsubpd|addsubps|adox|aesdec|aesdeclast|aesenc|aesenclast|aesimc|aeskeygenassist|and|andn|andnpd|andnps|andpd|andps|arpl|bextr|blendpd|blendps|blendvpd|blendvps|blsi|blsmsk|blsr|bndcl|bndcu|bndcn|bndldx|bndmk|bndmov|bndstx|bound|bsf|bsr|bswap|bt|btc|btr|bts|bzhi|call|cbw|cwde|cdqe|cwd|cdq|cqo|clac|clc|cld|cldemote|clflush|clflushopt|cli|clts|clwb|cmc|cmovcc|cmp|cmppd|cmpps|cmps|cmpsb|cmpsw|cmpsd|cmpsq|cmpss|cmpxchg|cmpxchg8b|cmpxchg16b|comisd|comiss|cpuid|crc32|cvtdq2pd|cvtdq2ps|cvtpd2dq|cvtpd2pi|cvtpd2ps|cvtpi2pd|cvtpi2ps|cvtps2dq|cvtps2pd|cvtps2pi|cvtsd2si|cvtsd2ss|cvtsi2sd|cvtsi2ss|cvtss2sd|cvtss2si|cvttpd2dq|cvttpd2pi|cvttps2dq|cvttps2pi|cvttsd2si|cvttss2si|daa|das|dec|div|divpd|divps|divsd|divss|dppd|dpps|emms|enter|extractps|f2xm1|fabs|fadd|faddp|fiadd|fbld|fbstp|fchs|fclex|fnclex|fcmovcc|fcom|fcomp|fcompp|fcomi|fcomip|fucomi|fucomip|fcos|fdecstp|fdiv|fdivp|fidiv|fdivr|fdivrp|fidivr|ffree|ficom|ficomp|fild|fmul|fmulp|fimul|fincstp|finit|fninit|fist|fistp|fisttp|fsub|fsubp|fisub|fsubr|fsubrp|fisubr|fld|fld1|fldl2t|fldl2e|fldpi|fldlg2|fldln2|fldz|fldcw|fldenv|fnop|fsave|fnsave|fstcw|fnstcw|fstenv|fnstenv|fstsw|fnstsw|fpatan|fprem|fprem1|fptan|frndint|frstor|fscale|fsin|fsincos|fsqrt|fst|fstp|ftst|fucom|fucomp|fucompp|wait|fwait|fxam|fxch|fxrstor|fxsave|fxtract|fyl2x|fyl2xp1|gf2p8affineinvqb|gf2p8affineqb|gf2p8mulb|haddpd|haddps|hlt|hsubpd|hsubps|idiv|imul|in|inc|ins|insb|insw|insd|insertps|intn|into|int3|int1|invd|invlpg|invpcid|iret|iretd|jmp|jb|jbe|ja|jae|je|jne|jz|jnz|jo|jno|jc|jnc|jl|jle|jg|jge|kaddw|kaddb|kaddq|kaddd|kandw|kandb|kandq|kandd|kandnw|kandnb|kandnq|kandnd|kmovw|kmovb|kmovq|kmovd|knotw|knotb|knotq|knotd|korw|korb|korq|kord|kortestw|kortestb|kortestq|kortestd|kshiftlw|kshiftlb|kshiftlq|kshiftld|kshiftrw|kshiftrb|kshiftrq|kshiftrd|ktestw|ktestb|ktestq|ktestd|kunpckbw|kunpckwd|kunpckdq|kxnorw|kxnorb|kxnorq|kxnord|kxorw|kxorb|kxorq|kxord|lahf|lar|lddqu|ldmxcsr|lds|les|lfs|lgs|lss|lea|leave|lfence|lgdt|lidt|lldt|lmsw|lock|lods|lodsb|lodsw|lodsd|lodsq|loop|loopcc|lsl|ltr|lzcnt|maskmovdqu|maskmovq|maxpd|maxps|maxsd|maxss|mfence|minpd|minps|minsd|minss|monitor|mov|mov-1|mov-2|movapd|movaps|movbe|movd|movq|movddup|movdir64b|movdiri|movdq2q|movdqa|vmovdqa32|vmovdqa64|movdqu|vmovdqu8|vmovdqu16|vmovdqu32|vmovdqu64|movhlps|movhpd|movhps|movlhps|movlpd|movlps|movmskpd|movmskps|movntdq|movntdqa|movnti|movntpd|movntps|movntq|movq2dq|movs|movsb|movsw|movsd|movsq|movshdup|movsldup|movss|movsx|movsxd|movupd|movups|movzx|mpsadbw|mul|mulpd|mulps|mulsd|mulss|mulx|mwait|neg|nop|not|or|orpd|orps|out|outs|outsb|outsw|outsd|pabsb|pabsw|pabsd|pabsq|packsswb|packssdw|packusdw|packuswb|paddb|paddw|paddd|paddq|paddsb|paddsw|paddusb|paddusw|palignr|pand|pandn|pause|pavgb|pavgw|pblendvb|pblendw|pclmulqdq|pcmpeqb|pcmpeqw|pcmpeqd|pcmpeqq|pcmpestri|pcmpestrm|pcmpgtb|pcmpgtw|pcmpgtd|pcmpgtq|pcmpistri|pcmpistrm|pdep|pext|pextrb|pextrd|pextrq|pextrw|phaddw|phaddd|phaddsw|phminposuw|phsubw|phsubd|phsubsw|pinsrb|pinsrd|pinsrq|pinsrw|pmaddubsw|pmaddwd|pmaxsb|pmaxsw|pmaxsd|pmaxsq|pmaxub|pmaxuw|pmaxud|pmaxuq|pminsb|pminsw|pminsd|pminsq|pminub|pminuw|pminud|pminuq|pmovmskb|pmovsx|pmovzx|pmuldq|pmulhrsw|pmulhuw|pmulhw|pmulld|pmullq|pmullw|pmuludq|pop|popa|popad|popcnt|popf|popfd|popfq|por|prefetchw|prefetchh|psadbw|pshufb|pshufd|pshufhw|pshuflw|pshufw|psignb|psignw|psignd|psllw|pslld|psllq|pslldq|psraw|psrad|psraq|psrlw|psrld|psrlq|psrldq|psubb|psubw|psubd|psubq|psubsb|psubsw|psubusb|psubusw|ptest|ptwrite|punpckhbw|punpckhwd|punpckhdq|punpckhqdq|punpcklbw|punpcklwd|punpckldq|punpcklqdq|push|pusha|pushad|pushf|pushfd|pushfq|pxor|rcl|rcr|rol|ror|rcpps|rcpss|rdfsbase|rdgsbase|rdmsr|rdpid|rdpkru|rdpmc|rdrand|rdseed|rdtsc|rdtscp|rep|repe|repz|repne|repnz|ret|rorx|roundpd|roundps|roundsd|roundss|rsm|rsqrtps|rsqrtss|sahf|sal|sar|shl|shr|sarx|shlx|shrx|sbb|scas|scasb|scasw|scasd|setcc|sfence|sgdt|sha1msg1|sha1msg2|sha1nexte|sha1rnds4|sha256msg1|sha256msg2|sha256rnds2|shld|shrd|shufpd|shufps|sidt|sldt|smsw|sqrtpd|sqrtps|sqrtsd|sqrtss|stac|stc|std|sti|stmxcsr|stos|stosb|stosw|stosd|stosq|str|sub|subpd|subps|subsd|subss|swapgs|syscall|sysenter|sysexit|sysret|test|tpause|tzcnt|ucomisd|ucomiss|ud|umonitor|umwait|unpckhpd|unpckhps|unpcklpd|unpcklps|valignd|valignq|vblendmpd|vblendmps|vbroadcast|vcompresspd|vcompressps|vcvtpd2qq|vcvtpd2udq|vcvtpd2uqq|vcvtph2ps|vcvtps2ph|vcvtps2qq|vcvtps2udq|vcvtps2uqq|vcvtqq2pd|vcvtqq2ps|vcvtsd2usi|vcvtss2usi|vcvttpd2qq|vcvttpd2udq|vcvttpd2uqq|vcvttps2qq|vcvttps2udq|vcvttps2uqq|vcvttsd2usi|vcvttss2usi|vcvtudq2pd|vcvtudq2ps|vcvtuqq2pd|vcvtuqq2ps|vcvtusi2sd|vcvtusi2ss|vdbpsadbw|verr|verw|vexpandpd|vexpandps|vextractf128|vextractf32x4|vextractf64x2|vextractf32x8|vextractf64x4|vextracti128|vextracti32x4|vextracti64x2|vextracti32x8|vextracti64x4|vfixupimmpd|vfixupimmps|vfixupimmsd|vfixupimmss|vfmadd132pd|vfmadd213pd|vfmadd231pd|vfmadd132ps|vfmadd213ps|vfmadd231ps|vfmadd132sd|vfmadd213sd|vfmadd231sd|vfmadd132ss|vfmadd213ss|vfmadd231ss|vfmaddsub132pd|vfmaddsub213pd|vfmaddsub231pd|vfmaddsub132ps|vfmaddsub213ps|vfmaddsub231ps|vfmsub132pd|vfmsub213pd|vfmsub231pd|vfmsub132ps|vfmsub213ps|vfmsub231ps|vfmsub132sd|vfmsub213sd|vfmsub231sd|vfmsub132ss|vfmsub213ss|vfmsub231ss|vfmsubadd132pd|vfmsubadd213pd|vfmsubadd231pd|vfmsubadd132ps|vfmsubadd213ps|vfmsubadd231ps|vfnmadd132pd|vfnmadd213pd|vfnmadd231pd|vfnmadd132ps|vfnmadd213ps|vfnmadd231ps|vfnmadd132sd|vfnmadd213sd|vfnmadd231sd|vfnmadd132ss|vfnmadd213ss|vfnmadd231ss|vfnmsub132pd|vfnmsub213pd|vfnmsub231pd|vfnmsub132ps|vfnmsub213ps|vfnmsub231ps|vfnmsub132sd|vfnmsub213sd|vfnmsub231sd|vfnmsub132ss|vfnmsub213ss|vfnmsub231ss|vfpclasspd|vfpclassps|vfpclasssd|vfpclassss|vgatherdpd|vgatherqpd|vgatherdps|vgatherqps|vgetexppd|vgetexpps|vgetexpsd|vgetexpss|vgetmantpd|vgetmantps|vgetmantsd|vgetmantss|vinsertf128|vinsertf32x4|vinsertf64x2|vinsertf32x8|vinsertf64x4|vinserti128|vinserti32x4|vinserti64x2|vinserti32x8|vinserti64x4|vmaskmov|vpblendd|vpblendmb|vpblendmw|vpblendmd|vpblendmq|vpbroadcast|vpbroadcastb|vpbroadcastw|vpbroadcastd|vpbroadcastq|vpbroadcastm|vpcmpb|vpcmpub|vpcmpd|vpcmpud|vpcmpq|vpcmpuq|vpcmpw|vpcmpuw|vpcompressd|vpcompressq|vpconflictd|vpconflictq|vperm2f128|vperm2i128|vpermb|vpermd|vpermw|vpermi2b|vpermi2w|vpermi2d|vpermi2q|vpermi2ps|vpermi2pd|vpermilpd|vpermilps|vpermpd|vpermps|vpermq|vpermt2b|vpermt2w|vpermt2d|vpermt2q|vpermt2ps|vpermt2pd|vpexpandd|vpexpandq|vpgatherdd|vpgatherqd|vpgatherdq|vpgatherqq|vplzcntd|vplzcntq|vpmadd52huq|vpmadd52luq|vpmaskmov|vpmovb2m|vpmovw2m|vpmovd2m|vpmovq2m|vpmovdb|vpmovsdb|vpmovusdb|vpmovdw|vpmovsdw|vpmovusdw|vpmovm2b|vpmovm2w|vpmovm2d|vpmovm2q|vpmovqb|vpmovsqb|vpmovusqb|vpmovqd|vpmovsqd|vpmovusqd|vpmovqw|vpmovsqw|vpmovusqw|vpmovwb|vpmovswb|vpmovuswb|vpmultishiftqb|vprold|vprolvd|vprolq|vprolvq|vprord|vprorvd|vprorq|vprorvq|vpscatterdd|vpscatterdq|vpscatterqd|vpscatterqq|vpsllvw|vpsllvd|vpsllvq|vpsravw|vpsravd|vpsravq|vpsrlvw|vpsrlvd|vpsrlvq|vpternlogd|vpternlogq|vptestmb|vptestmw|vptestmd|vptestmq|vptestnmb|vptestnmw|vptestnmd|vptestnmq|vrangepd|vrangeps|vrangesd|vrangess|vrcp14pd|vrcp14ps|vrcp14sd|vrcp14ss|vreducepd|vreduceps|vreducesd|vreducess|vrndscalepd|vrndscaleps|vrndscalesd|vrndscaless|vrsqrt14pd|vrsqrt14ps|vrsqrt14sd|vrsqrt14ss|vscalefpd|vscalefps|vscalefsd|vscalefss|vscatterdps|vscatterdpd|vscatterqps|vscatterqpd|vshuff32x4|vshuff64x2|vshufi32x4|vshufi64x2|vtestpd|vtestps|vzeroall|vzeroupper|wbinvd|wrfsbase|wrgsbase|wrmsr|wrpkru|xabort|xacquire|xrelease|xadd|xbegin|xchg|xend|xgetbv|xlat|xlatb|xor|xorpd|xorps|xrstor|xrstors|xsave|xsavec|xsaveopt|xsaves|xsetbv|xtest|encls|eadd|eaug|eblock|ecreate|edbgrd|edbgwr|eextend|einit|eldb|eldu|eldbc|elbuc|emodpr|emodt|epa|erdinfo|eremove|etrackc|etrack|ewb|enclu|eacceptcopy|eaccept|eenter|eexit|egetkey|emodpe|ereport|eresume|enclv|edecvirtchild|eincvirtchild|esetcontext|capabilities|enteraccs|exitac|parameters|senter|sexit|smctrl|wakeup|invept|invvpid|vmcall|vmclear|vmfunc|vmlaunch|vmresume|vmptrld|vmptrst|vmread|vmwrite|vmxoff|vmxon|prefetchwt1|v4fmaddps|v4fnmaddps|v4fmaddss|v4fnmaddss|vexp2pd|vexp2ps|vgatherpf0dps|vgatherpf0qps|vgatherpf0dpd|vgatherpf0qpd|vgatherpf1dps|vgatherpf1qps|vgatherpf1dpd|vgatherpf1qpd|vp4dpwssd|vp4dpwssds|vrcp28pd|vrcp28ps|vrcp28sd|vrcp28ss|vrsqrt28pd|vrsqrt28ps|vrsqrt28sd|vrsqrt28ss|vscatterpf0dps|vscatterpf0qps|vscatterpf0dpd|vscatterpf0qpd|vscatterpf1dps|vscatterpf1qps|vscatterpf1dpd|vscatterpf1qpd|ldr|bls|stp|adrp|ldp|mov|mvn|add|sub|mul|lsl|lsr|asr|orr|eor|ldr|str|ldm|stm|b|bl|bx|blx|swi|svc|bal|beq|bne|bpl|bmi|bcc|blo|bcs|bhs|bvc|bvs|bgt|bge|blt|ble|bhi|bls|bih|bls|stmia|stmib|ldmdb|ldmda)\b
      scope: keyword.control.asm

    - match: '(macro|endmacro)'
    #   scope: keyword.control.asm
    # - match: \b\w+(?=\:)\b
      scope: keyword.operator.assignment.asm

    - match: \b\w+(?=\:)\b
#      scope: entity.name.label.asm
      scope: entity.name.function.asm

    - match: \b(a|af|b|bc|c|d|de|e|h|hl|i|ix|iy|l|r|sp)\b
      scope: variable.parameter.register.asm
    - match: '.include|.global|.extern|.section|global|extern|include|section|\$'
      scope: keyword.control.import

    - match: \b[0-9]+\b
      scope: constant.numeric.integer.decimal.asm

    - match: '\$[0-9|a-f|A-F]+'
      scope: constant.numeric.integer.hexadecimal.asm

    - match: '(\+|-|\*|\/|#|!)'
      scope: keyword.operator.arithmetic.asm

    - match: ','
      scope: punctuation.separator

    - match: '\.'
      scope: punctuation.accessor

    - match: '\('
      push: parenthesis
      scope: punctuation.section.group.begin.asm

    - match: '\)'
      scope: invalid.illegal.stray-bracket-end.asm

    - match: \b(db|dw|dd|dq|dl|rb|rw|rl|resb|resw|resd|resq|byte|word|dword|qword|tbyte|paragraph|ascii|asciz|string)\b
      scope: storage.type

    - match: ';'
      scope: punctuation.definition.comment
      push: comment.line

    - match: "('|\")"
      push: string

  string:
    - meta_scope: string.quoted.single.asm
    - match: \\.
      scope: constant.character.escape.asm

    - match: "('|\")"
      pop: true

  comment.line:
    - meta_scope: comment.line.asm
    - match: '\n'
      pop: true

  parenthesis:
    - match: \)
      scope: punctuation.section.group.end.asm
      pop: true
    - include: main
